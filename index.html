<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>LOVE CHI ❤️</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #111;
    }

    #startButton {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 16px 32px;
      font-size: 20px;
      background: #ff0066;
      border: none;
      border-radius: 10px;
      color: white;
      cursor: pointer;
      z-index: 10;
    }

    canvas {
      display: block;
    }
  </style>
</head>
<body>

<button id="startButton">Bắt đầu ❤️</button>

<!-- p5.js và p5.sound -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/addons/p5.sound.min.js"></script>

<script>
  let bgMusic;
  let started = false;
  let heartSize = 0;
  let targetSize = 15;
  let growthSpeed = 0.05;

  // Lời bài hát: thời gian giây + nội dung
  const lyrics = [
    { time: 6,    text: "Gửi tới em ❤️" },
    { time: 11,    text: "Anh xin lỗi..." },
    { time: 16,    text: "Vì những lúc anh vô tâm, làm em buồn." },
    { time: 22,    text: "Anh không cố ý, nhưng lại làm em tổn thương." },
    { time: 28,   text: "Anh yêu em rất nhiều." },
    { time: 34,   text: "Xin em tha thứ cho anh..." },
  ];

  let currentLyric = "";

  function preload() {
    soundFormats('mp3', 'ogg');
    bgMusic = loadSound('audio.mp3');
  }

  function setup() {
    createCanvas(window.innerWidth, window.innerHeight);
    textAlign(CENTER, CENTER);
    textSize(16);
    textFont('sans-serif');
    fill(255);
    noStroke();
  }

  function drawHeart(x, y, size) {
    stroke(255, 0, 100);
    strokeWeight(2);
    noFill();
    beginShape();
    for (let t = 0; t < TWO_PI; t += 0.01) {
      let x1 = 16 * pow(sin(t), 3);
      let y1 = - (13 * cos(t) - 5 * cos(2 * t) - 2 * cos(3 * t) - cos(4 * t));
      vertex(x + size * x1, y + size * y1);
    }
    endShape(CLOSE);
  }

  function drawLyrics() {
    let t = bgMusic.currentTime();
    for (let i = 0; i < lyrics.length; i++) {
      if (t >= lyrics[i].time && (i === lyrics.length - 1 || t < lyrics[i + 1].time)) {
        currentLyric = lyrics[i].text;
        break;
      }
    }

    if (currentLyric && heartSize > 4) {
      fill(255, 255, 255, 230);
      noStroke();
      text(currentLyric, width / 2, height / 2);
    }
  }

  function draw() {
    if (!started) return;

    background(17, 17, 17, 25);

    if (heartSize < targetSize) {
      heartSize += growthSpeed;
    }

    let time = millis() / 1000;
    let pulse = sin(time * 2) * 0.5;
    let currentSize = heartSize + pulse;

    drawHeart(width / 2, height / 2, currentSize);
    setTimeout(() => {
      drawLyrics();
    }, 5900);
  }

  function windowResized() {
    resizeCanvas(window.innerWidth, window.innerHeight);
  }

  document.getElementById('startButton').addEventListener('click', function () {
    if (!started) {
      bgMusic.setVolume(0.5);
      bgMusic.play();
      started = true;
      this.style.display = 'none';
      loop();
    }
  });

  noLoop();
</script>

</body>
</html>
